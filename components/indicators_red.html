<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>–ò–Ω–¥–µ–∫—Å –∫–∞—á–µ—Å—Ç–≤–∞ –∂–∏–∑–Ω–∏</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- MathJax –¥–ª—è LaTeX -->
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>


    <style>
        /* –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–∏–ª—å */
        body {
            margin: 0;
            display: flex;
            height: 100vh;
            font-family: 'Roboto', Arial, sans-serif;
            background: linear-gradient(135deg, #f3f4f6, #e2e5ea);
        }

        /* –ö–∞—Ä—Ç–∞ */
        #map {
            flex: 1;
            width: 100%; /* –£–±–µ–¥–∏—Ç—å—Å—è –≤ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ —à–∏—Ä–∏–Ω—ã */
            height: 100%; /* –£–±–µ–¥–∏—Ç—å—Å—è –≤ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤—ã—Å–æ—Ç—ã */
        }

        /* –°–∞–π–¥–±–∞—Ä */
        .sidebar {
            width: 400px;
            max-width: 80%; /* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
            padding: 12px;
            background: rgba(20, 30, 50, 0.95);
            color: #ffffff;
            box-shadow: 2px 0 12px rgba(0, 0, 0, 0.3);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            height: 100%; /* –ü–æ–ª–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
            position: fixed; /* –§–∏–∫—Å–∞—Ü–∏—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ */
            left: 0;
            top: 0;
            transition: transform 0.3s ease, opacity 0.3s ease; /* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã */
            transform: translateX(0); /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∏–¥–∏–º–∞ */
            z-index: 100; /* –ù–∞–¥ –∫–∞—Ä—Ç–æ–π */
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
            opacity: 0; /* –î–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è */
            transition: transform 0.3s ease, opacity 0.3s ease; /* –ê–Ω–∏–º–∞—Ü–∏—è */
        }


        /* –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª—å—é */
        .toggle-sidebar {
            position: fixed;
            top: 20px;
            left: 410px; /* –ü—Ä–∏–º–µ—Ä–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ */
            z-index: 110; /* –ù–∞–¥ –ø–∞–Ω–µ–ª—å—é */
            width: 40px;
            height: 40px;
            background: linear-gradient(145deg, #7b9cc0, #2e4359); /* –ì—Ä–∞–¥–∏–µ–Ω—Ç */
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            transition: left 0.3s ease, background 0.2s ease;
        }

        .toggle-sidebar.collapsed {
            left: 20px; /* –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —É –∫—Ä–∞—è —ç–∫—Ä–∞–Ω–∞ */
        }

        .toggle-sidebar i {
            font-size: 20px;
            transition: transform 0.3s ease;
        }

        .toggle-sidebar.collapsed i {
            transform: rotate(180deg); /* –ü–æ–≤–æ—Ä–æ—Ç —Å—Ç—Ä–µ–ª–∫–∏ */
        }

        .toggle-sidebar.collapsed {
            left: 0; /* –ö–Ω–æ–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —É –∫—Ä–∞—è –æ–∫–Ω–∞ */
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 300px; /* –£–º–µ–Ω—å—à–∞–µ–º —à–∏—Ä–∏–Ω—É */
            }

            .toggle-sidebar {
                left: 310px; /* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ */
            }

            .toggle-sidebar.collapsed {
                left: 20px;
            }
        }


        /* –õ–µ–≥–µ–Ω–¥–∞ */
        .legend {
            margin-top: 20px;
            background: rgba(30, 50, 80, 0.9);
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .legend h4 {
            font-size: 18px;
            color: #4fc3f7;
            margin-bottom: 10px;
        }

        .legend ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            font-size: 16px
        }


        .legend li {
            font-size: 14px;
            color: #e3f2fd;
            margin-bottom: 5px;
        }

        /* –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∞–π–¥–±–∞—Ä–æ–º */
        .toggle-sidebar {
            position: fixed;
            top: 20px;
            left: 400px; /* –ò–ª–∏ –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∑–∞–≤–∏—Å—è—â–µ–µ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
            z-index: 1000; /* –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã—à–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
            width: 40px;
            height: 40px;
            background: linear-gradient(145deg, #7b9cc0, #2e4359);
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            transition: left 0.3s ease, background 0.2s ease;
        }


        .toggle-sidebar:hover {
            background: linear-gradient(135deg, #7c939e, #2a5975);
            transform: scale(1.1);
        }

        /* –¢–∞–±–ª–∏—Ü—ã */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 14px;
            color: #e3f2fd;
            background: rgba(20, 30, 50, 0.95);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        th {
            background: rgba(40, 60, 90, 0.9);
            font-weight: bold;
            color: #fbc02d;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        td {
            background: rgba(30, 50, 80, 0.8);
            color: #b3c7e6;
        }

        tr:nth-child(even) td {
            background: rgba(30, 50, 80, 0.7);
        }

        tr:hover td {
            background: rgba(50, 70, 100, 0.9);
            color: #ffffff;
            transition: background 0.3s ease-in-out, color 0.3s ease-in-out;
        }

        /* –ì—Ä–∞—Ñ–∏–∫ */
        .chart-container {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 380px;
            height: 280px;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            padding: 15px;
            z-index: 5;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease-in-out;
            transform-origin: top right;
        }

        .chart-container.expanded {
            width: 600px;
            height: 400px;
        }

        .expand-chart {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #7c8f98, #296585);
            color: #ffffff;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.3s, background 0.3s;
        }

        .expand-chart:hover {
            background: linear-gradient(135deg, #98a5ab, #356580);
            transform: scale(1.1);
        }

        .chart-container.minimized {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #7c8f98, #296585);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.3s ease-in-out;
        }

        .chart-container.minimized canvas,
        .chart-container.minimized button {
            display: none; /* –ü—Ä—è—á–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ */
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–Ω–æ–ø–æ–∫ –≤–Ω—É—Ç—Ä–∏ –≥—Ä–∞—Ñ–∏–∫–∞ */
        .chart-controls {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 6px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
        }

        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        .chart-controls button {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #7c8f98, #296585);
            color: #ffffff;
            border: none;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .chart-controls button:hover {
            background: linear-gradient(135deg, #98a5ab, #356580);
            transform: scale(1.1);
        }

        .chart-controls button:active {
            transform: scale(0.9);
        }


        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫ */
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        .button-container {
            position: fixed;
            bottom: 20px; /* –ü—Ä–∏–∂–∏–º–∞–µ–º –∫ –Ω–∏–∑—É */
            right: 20px; /* –°–ø—Ä–∞–≤–∞ */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
            z-index: 1000;
            background: rgba(20, 30, 50, 0.85);
            border-radius: 12px;
            padding: 10px 5px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* –†—è–¥—ã –∫–Ω–æ–ø–æ–∫ */
        .button-row {
            display: flex;
            justify-content: center;
            gap: 6px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ –≤ —Ä—è–¥—É */
        }

        /* –°—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫ */
        .action-button {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #6d8692, #2e5d76);
            color: #ffffff;
            border: none;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .action-button:hover {
            background: linear-gradient(135deg, #7c939e, #2a5975);
            transform: scale(1.1);
        }

        .action-button:active {
            transform: scale(0.95);
        }

        /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–ª–∞–π–¥–µ—Ä */
        .transparency-slider-horizontal {
            margin-top: 10px;
            width: 80%; /* –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –ø–æ —à–∏—Ä–∏–Ω–µ */
        }

        .transparency-slider-horizontal input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #d3d3d3;
            border-radius: 5px;
            outline: none;
            cursor: pointer;
        }

        .transparency-slider-horizontal input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 15px;
            height: 15px;
            background: #2e5d76;
            border: 2px solid #ffffff;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease;
        }

        .transparency-slider-horizontal input[type="range"]:hover::-webkit-slider-thumb {
            transform: scale(1.2);
        }



        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            top: 20px; /* –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
            right: 20px; /* –ü—Ä–∏–∂–∏–º–∞–µ–º –∫ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é */
            width: 350px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
            height: auto; /* –í—ã—Å–æ—Ç–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            border-radius: 8px;
            z-index: 1000;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background: linear-gradient(135deg, #f9fafb, #ffffff);
            color: #333;
            margin: 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: -4px -4px 10px rgba(0, 0, 0, 0.3);
            max-height: 90vh; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã */
            overflow-y: auto; /* –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ */
        }


        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç */
        .modal-content h3 {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #1a76d2;
            text-align: center;
        }

        .modal-content h4 {
            font-size: 1.2rem;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #555;
            border-bottom: 2px solid #e0e0e0;
            display: inline-block;
        }

        .modal-content p, .modal-content ul {
            font-size: 1rem;
            line-height: 1.6;
            color: #555;
        }

        .modal-content ul {
            padding-left: 20px;
        }

        .modal-content ul li {
            margin: 10px 0;
            font-weight: 500;
        }

        .close-modal {
            color: #555;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease-in-out;
        }

        .close-modal:hover {
            color: #d32f2f;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }




    </style>
    
</head>

<body>
    <!-- –°–∞–π–¥–±–∞—Ä -->
    <div class="sidebar" id="sidebar">
        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ -->
        <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Ä–∞–π–æ–Ω—É</h3>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω –Ω–∞ –∫–∞—Ä—Ç–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –≥—Ä–∞—Ñ–∏–∫–∏.</p>
        <div class="info">
            <strong> </strong>
            <div id="district-info">
                <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.</p>
            </div>
        </div>
        <div class="legend">
            <h4>–õ–µ–≥–µ–Ω–¥–∞:</h4>
            <ul>
                <li><span style="color: #1a9641;">‚óè</span> –í—ã—Å–æ–∫–∏–π –∏–Ω–¥–µ–∫—Å QoL (0.5 - 1.00)</li>
                <li><span style="color: #a6d96a;">‚óè</span> –í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –∏–Ω–¥–µ–∫—Å QoL (0.3 - 0.49)</li>
                <li><span style="color: #fdae61;">‚óè</span> –°—Ä–µ–¥–Ω–∏–π –∏–Ω–¥–µ–∫—Å QoL (0.2 - 0.29)</li>
                <li><span style="color: #d7191c;">‚óè</span> –û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π –∏–Ω–¥–µ–∫—Å QoL (0.1 - 0.19)</li>
                <li><span style="color: #6c757d;">‚óè</span> –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –Ω—É–ª–µ–≤–æ–π –∏–Ω–¥–µ–∫—Å</li>
            </ul>            
        </div>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <button class="toggle-sidebar" id="toggleSidebar" title="–°–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å">
        <i class="fas fa-chevron-left"></i>
    </button>
    

    <!-- –ö–∞—Ä—Ç–∞ -->
    <div id="map" class="map-container"></div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
    <div class="charts-wrapper">
        
        <!-- –ì—Ä–∞—Ñ–∏–∫ QoL -->
        <div class="chart-container minimized" id="chartContainer">
            <canvas id="qChart"></canvas>
            <div class="chart-controls">
                <button class="toggle-chart" id="expandChart" title="–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≥—Ä–∞—Ñ–∏–∫">
                    <i class="fas fa-expand"></i>
                </button>
            </div>
        </div>

        <!-- –ì—Ä–∞—Ñ–∏–∫ QoL –ø–æ —Ä–∞–π–æ–Ω–∞–º -->
        <div class="chart-container minimized" id="multiDistrictChartContainer">
            <canvas id="multiDistrictChart"></canvas>
            <div class="chart-controls">
                <button class="toggle-chart" id="toggleMultiDistrictFullscreen" title="–í–æ –≤–µ—Å—å —ç–∫—Ä–∞–Ω">
                    <i class="fas fa-expand"></i>
                </button>
            </div>
        </div>
        

        <!-- –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
        <div class="chart-buttons">
            <button id="showSingleDistrictChart" class="action-button" title="–ì—Ä–∞—Ñ–∏–∫ QoL –¥–ª—è —Ä–∞–π–æ–Ω–∞">
                <i class="fas fa-chart-line"></i>
            </button>
            <button id="showMultiDistrictChart" class="action-button" title="–ì—Ä–∞—Ñ–∏–∫ QoL –ø–æ —Ä–∞–π–æ–Ω–∞–º">
                <i class="fas fa-chart-area"></i>
            </button>
        </div>
        

    </div>


    <div class="button-container">
        <div class="button-row">
            <button id="showCurrentQ" class="action-button" title="–ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π QoL">
                <i class="fas fa-chart-line"></i>
            </button>
            <button id="showPreviousQ" class="action-button" title="–ü–æ–∫–∞–∑–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ QoL">
                <i class="fas fa-history"></i>
            </button>
        </div>
        <div class="button-row">
            <button id="showMethodology" class="action-button" title="–ú–µ—Ç–æ–¥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ QoL">
                <i class="fas fa-info-circle"></i>
            </button>
            <button id="fullscreen-toggle" class="action-button" title="–í–æ –≤–µ—Å—å —ç–∫—Ä–∞–Ω">
                <i class="fas fa-expand"></i>
            </button>
        </div>
        <!-- –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–ª–∞–π–¥–µ—Ä –¥–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ -->
        <div class="transparency-slider-horizontal">
            <input id="opacity-slider" type="range" min="0" max="1" step="0.1" value="0.7" title="–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å">
        </div>
    </div>
    
    


    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –º–µ—Ç–æ–¥–∏–∫–∏ -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>–ú–µ—Ç–æ–¥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ –∏–Ω–¥–µ–∫—Å–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∂–∏–∑–Ω–∏ (QoL)</h3>
            
            <p>
                –ò–Ω–¥–µ–∫—Å –∫–∞—á–µ—Å—Ç–≤–∞ –∂–∏–∑–Ω–∏ (QoL) –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –≤ –∫–ª—é—á–µ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
            </p>
            <ul>
                <li><strong>–î–µ–º–æ–≥—Ä–∞—Ñ–∏—è:</strong> —Ä–æ–∂–¥–∞–µ–º–æ—Å—Ç—å, —Å–º–µ—Ä—Ç–Ω–æ—Å—Ç—å, –º–∏–≥—Ä–∞—Ü–∏—è.</li>
                <li><strong>–≠–∫–æ–Ω–æ–º–∏–∫–∞:</strong> —É—Ä–æ–≤–µ–Ω—å –∑–∞—Ä–ø–ª–∞—Ç, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π.</li>
                <li><strong>–ñ–∏–ª–∏—â–Ω—ã–µ —É—Å–ª–æ–≤–∏—è:</strong> –≤–≤–æ–¥ –∂–∏–ª—å—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∏—Ä.</li>
                <li><strong>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:</strong> –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å–º–µ—Ä—Ç–Ω–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–∏—á–∏–Ω.</li>
            </ul>
    
            <h4>–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á—ë—Ç–∞:</h4>
            <p style="text-align: center;">
                \( Q = w_D \cdot D + w_E \cdot E + w_H \cdot H + w_S \cdot S + w_{SS} \cdot SS \)
            </p>
            <p>
                –≥–¥–µ:
                <ul>
                    <li>\( Q \) ‚Äî –∏—Ç–æ–≥–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å –∫–∞—á–µ—Å—Ç–≤–∞ –∂–∏–∑–Ω–∏.</li>
                    <li>\( D, E, H, S, SS \) ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π.</li>
                    <li>\( w \) ‚Äî –≤–µ—Å–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, \( w_D = 0.25 \)).</li>
                </ul>
            </p>
    
            <h4>–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:</h4>
            <p style="text-align: center;">
                \( x_{\text{norm}} = \frac{x - x_{\text{min}}}{x_{\text{max}} - x_{\text{min}}} \)
            </p>
            <p>
                –≥–¥–µ \( x \) ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è, \( x_{\text{min}}, x_{\text{max}} \) ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏—è.
            </p>
        </div>
    </div>
    

    <script>
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ–∫–µ–Ω Mapbox
        mapboxgl.accessToken = 'pk.eyJ1IjoiYWxpbmFjaCIsImEiOiJjbGlpcnZpaTgwMTZ4M2twaGo1NjRsNHhhIn0.9jw_R_D1i1nqOtaolld-dQ';
        
        // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –∫–∞—Ä—Ç—ã
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [76.945, 43.255], // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞
            zoom: 10
        });

        // URL –¥–ª—è –¥–∞–Ω–Ω—ã—Ö GeoJSON
        const geojsonUrl = 'https://raw.githubusercontent.com/alinachrks/fun_house/main/qol_results_full_geo%20(2).geojson';

        let fullDataset = []; // –•—Ä–∞–Ω–∏–ª–∏—â–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        let popup; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –≤—Å–ø–ª—ã–≤–∞—é—â–µ–π –ø–æ–¥—Å–∫–∞–∑–∫–∏
        let chartInstance; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
        let showCurrent = true; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º Q


        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ GeoJSON –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞—Ä—Ç—ã
        map.on('load', async () => {
            try {
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ GeoJSON
                const response = await fetch(geojsonUrl);
                const geojsonData = await response.json();

                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Ö –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                fullDataset = geojsonData.features.map(feature => feature.properties);

                // –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–∞—Ä—Ç—É
                addGeoJsonSource('districts', geojsonData);

                // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–π–æ–Ω–æ–≤
                addDistrictLayers();

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è –∫–∞—Ä—Ç—ã
                setupMapInteractions();

                console.log('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞ –∫–∞—Ä—Ç—É:', geojsonData);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ GeoJSON:', error);
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ GeoJSON
        function addGeoJsonSource(sourceId, geojsonData) {
            map.addSource(sourceId, {
                type: 'geojson',
                data: geojsonData,
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ–µ–≤ –Ω–∞ –∫–∞—Ä—Ç—É
        function addDistrictLayers() {
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–π –∑–∞–ª–∏–≤–∫–∏ —Ä–∞–π–æ–Ω–æ–≤
            map.addLayer({
                id: 'districts-layer',
                type: 'fill',
                source: 'districts',
                paint: {
                    'fill-color': [
                        'step',
                        ['get', 'QoL'], 
                        '#6c757d', // –¶–≤–µ—Ç –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã—Ö
                        0.1, '#d7191c', // –û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π –∏–Ω–¥–µ–∫—Å
                        0.2, '#fdae61', // –°—Ä–µ–¥–Ω–∏–π –∏–Ω–¥–µ–∫—Å
                        0.3, '#a6d96a', // –í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ
                        0.5, '#1a9641'  // –í—ã—Å–æ–∫–∏–π –∏–Ω–¥–µ–∫—Å
                    ],
                    'fill-opacity': 0.7, // –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                },
            });

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–π –∫–æ–Ω—Ç—É—Ä–æ–≤ —Ä–∞–π–æ–Ω–æ–≤
            map.addLayer({
                id: 'districts-line',
                type: 'line',
                source: 'districts',
                paint: {
                    'line-color': '#ffffff',
                    'line-width': 1,
                },
            });

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–π –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Ä–∞–π–æ–Ω–æ–≤ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
            map.addLayer({
                id: 'districts-highlight',
                type: 'fill',
                source: 'districts',
                paint: {
                    'fill-color': '#ffff00',
                    'fill-opacity': 0.8,
                },
                filter: ['==', 'district_name', ''], // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø—É—Å—Ç–æ–π —Ñ–∏–ª—å—Ç—Ä
            });

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∏–∑ —Å–ª–∞–π–¥–µ—Ä–∞
            setInitialOpacity();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ –∏–∑ –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–∞–π–¥–µ—Ä–∞
        function setInitialOpacity() {
            const opacitySlider = document.getElementById("opacity-slider");
            const initialOpacity = parseFloat(opacitySlider.value) || 0.7;
            map.setPaintProperty('districts-layer', 'fill-opacity', initialOpacity);

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–ª–∞–π–¥–µ—Ä–∞
            opacitySlider.addEventListener("input", (e) => {
                const opacity = parseFloat(e.target.value);
                map.setPaintProperty('districts-layer', 'fill-opacity', opacity);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ –∫–∞—Ä—Ç–µ
        function setupMapInteractions() {
            map.on('mousemove', 'districts-layer', handleHover);
            map.on('mouseleave', 'districts-layer', clearHover);
            map.on('click', 'districts-layer', handleClick);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏—è –º—ã—à–∏
        function handleHover(e) {
            const properties = e.features[0].properties;

            const districtName = properties.orig_district_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–∞–π–æ–Ω';
            const currentValue = properties.QoL !== undefined ? properties.QoL.toFixed(2) : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            const change = properties.QoL_change !== null ? properties.QoL_change.toFixed(2) : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
            const population = properties["orig_–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏—è"] || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            const housingInput = properties["orig_–í–≤–æ–¥ –∂–∏–ª—å—è"] || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';

            if (popup) popup.remove();
            popup = new mapboxgl.Popup({ closeButton: false })
                .setLngLat(e.lngLat)
                .setHTML(`
                    <strong>${districtName}</strong><br>
                    <strong>–ò–Ω–¥–µ–∫—Å –∫–∞—á–µ—Å—Ç–≤–∞ –∂–∏–∑–Ω–∏ (QoL):</strong> ${currentValue}<br>
                    <strong>–ò–∑–º–µ–Ω–µ–Ω–∏–µ QoL:</strong> ${change}%<br>
                    <strong>–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏—è:</strong> ${population}<br>
                    <strong>–í–≤–æ–¥ –∂–∏–ª—å—è:</strong> ${housingInput} —Ç—ã—Å. –∫–≤.–º.<br>
                    <em>–î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Ä–∞–π–æ–Ω</em>
                `)
                .addTo(map);

            // –û–±–Ω–æ–≤–ª—è–µ–º –∫—É—Ä—Å–æ—Ä
            map.getCanvas().style.cursor = 'pointer';

            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ä–∞–π–æ–Ω–∞
            map.setFilter('districts-highlight', ['==', 'district_name', districtName]);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
        function clearHover() {
            map.setFilter('districts-highlight', ['==', 'district_name', '']);
            if (popup) popup.remove();
            map.getCanvas().style.cursor = '';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–æ–≤ –Ω–∞ —Ä–∞–π–æ–Ω—ã
        function handleClick(e) {
            const properties = e.features[0].properties;
            const districtName = properties.orig_district_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–∞–π–æ–Ω';

            // –°–ø–∏—Å–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const parameters = [
                // üìä –î–µ–º–æ–≥—Ä–∞—Ñ–∏—è
                "–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏—è", "–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å —Ä–æ–¥–∏–≤—à–∏—Ö—Å—è", "–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å —É–º–µ—Ä—à–∏—Ö",
                "–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç", "–ö–æ—ç—Ñ—Ñ–∏—Ü–µ–Ω—Ç —Ä–æ–∂–¥–∞–µ–º–æ—Å—Ç–∏ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫", "–ö–æ—ç—Ñ—Ñ–∏—Ü–µ–Ω—Ç —Å–º–µ—Ä—Ç–Ω–æ—Å—Ç–∏ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫",
                "–ö–æ—ç—Ñ—Ñ–∏—Ü–µ–Ω—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏—Ä–æ—Å—Ç–∞ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫", "–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞—Å–µ–ª–µ–Ω–∏—è - –≤—ã–±—ã–ª–æ", 
                "–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞—Å–µ–ª–µ–Ω–∏—è - –ø—Ä–∏–±—ã–ª–æ", "–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞—Å–µ–ª–µ–Ω–∏—è - —Å–∞–ª—å–¥–æ",

                // üèó –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∂–∏–ª—å—ë
                "–í–≤–æ–¥ –∂–∏–ª—å—è", "–ú–Ω–æ–≥–æ–∫–≤–∞—Ä—Ç–∏—Ä–Ω—ã–µ –∂–∏–ª—ã–µ –¥–æ–º–∞", "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∂–∏–ª—ã–µ –¥–æ–º–∞",
                "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∏—Ä - –º–Ω–æ–≥–æ–∫–≤–∞—Ä—Ç–∏—Ä–Ω—ã–µ –¥–æ–º–∞",

                // üí∞ –≠–∫–æ–Ω–æ–º–∏–∫–∞
                "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö", "–°—Ä–µ–¥–Ω–µ–º–µ—Å—è—á–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ-–ø—Ä–∞–≤–æ–≤—ã–º —Ñ–æ—Ä–º–∞–º",
                "–ò–Ω–¥–µ–∫—Å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –æ–±—ä—ë–º–∞, –ø–æ –≤—Å–µ–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç–∏", "–û–±—ä—ë–º –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏ –ø–æ –≤—Å–µ–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç–∏",
                "–í—Å–µ–≥–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö –∫—Ä—É–ø–Ω—ã—Ö –∏ —Å—Ä–µ–¥–Ω–∏—Ö –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π", "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫—Ä—É–ø–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π",
                "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞–ª—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π", "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ä–µ–¥–Ω–∏—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π",
                "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—É–±—ä–µ–∫—Ç–æ–≤ –≤—Å–µ–≥–æ –ø–æ —Ä–∞–π–æ–Ω—É", "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö —Å—É–±—ä–µ–∫—Ç–æ–≤ –≤—Å–µ–≥–æ –ø–æ —Ä–∞–π–æ–Ω—É",
                "–î–µ–π—Å—Ç–≤—É—é—â–∏–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—É–±—ä–µ–∫—Ç—ã –º–∞–ª–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–∞",
                "–í—Å–µ–≥–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—É–±—ä–µ–∫—Ç–æ–≤ –º–∞–ª–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–∞ (—é—Ä–∏–¥. –∏ —Ñ–∏–∑. –ª–∏—Ü–∞)",
                "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π", "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö —á–∞—Å—Ç–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π",
                "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π",

                // üö® –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å–º–µ—Ä—Ç–Ω–æ—Å—Ç—å
                "–ö–æ—ç—Ñ—Ñ–∏—Ü–µ–Ω—Ç –º–ª–∞–¥–µ–Ω—á–µ—Å–∫–æ–π —Å–º–µ—Ä—Ç–Ω–æ—Å—Ç–∏ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫", "–£–º–µ—Ä—à–∏–µ –æ—Ç –Ω–µ—Å—á–∞—Å—Ç–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤, –æ—Ç—Ä–∞–≤–ª–µ–Ω–∏–π –∏ —Ç—Ä–∞–≤–º",
                "–£–º–µ—Ä—à–∏–µ –æ—Ç —Å–∞–º–æ—É–±–∏–π—Å—Ç–≤", "–£–º–µ—Ä—à–∏–µ –æ—Ç –±–æ–ª–µ–∑–Ω–µ–π –æ—Ä–≥–∞–Ω–æ–≤ –¥—ã—Ö–∞–Ω–∏—è", "–£–º–µ—Ä—à–∏–µ –æ—Ç –±–æ–ª–µ–∑–Ω–µ–π –æ—Ä–≥–∞–Ω–æ–≤ –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏—è",
                "–£–º–µ—Ä—à–∏–µ –æ—Ç –±–æ–ª–µ–∑–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏—è", "–£–º–µ—Ä—à–∏–µ –æ—Ç –≥–∏–ø–µ—Ä—Ç–æ–Ω–∏—á–µ—Å–∫–æ–π –±–æ–ª–µ–∑–Ω–∏",
                "–£–º–µ—Ä—à–∏–µ –æ—Ç –≥—Ä–∏–ø–ø–∞, –û–†–ó –∏ –ø–Ω–µ–≤–º–æ–Ω–∏–∏", "–£–º–µ—Ä—à–∏–µ –æ—Ç –¥–æ—Ä–æ–∂–Ω–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏–π",
                "–£–º–µ—Ä—à–∏–µ –æ—Ç –∑–ª–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –Ω–æ–≤–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π", "–£–º–µ—Ä—à–∏–µ –æ—Ç –∏–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω—ã—Ö –∏ –ø–∞—Ä–∞–∑–∏—Ç–∞—Ä–Ω—ã—Ö –±–æ–ª–µ–∑–Ω–µ–π",
                "–£–º–µ—Ä—à–∏–µ –æ—Ç –∏—à–µ–º–∏—á–µ—Å–∫–æ–π –±–æ–ª–µ–∑–Ω–∏ —Å–µ—Ä–¥—Ü–∞", "–£–º–µ—Ä—à–∏–µ –æ—Ç –Ω–æ–≤–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π", "–£–º–µ—Ä—à–∏–µ –æ—Ç –æ—Å—Ç—Ä–æ–≥–æ –∏–Ω—Ñ–∞—Ä–∫—Ç–∞ –º–∏–æ–∫–∞—Ä–¥–∞",
                "–£–º–µ—Ä—à–∏–µ –æ—Ç —Å—Ç–µ–Ω–æ–∫–∞—Ä–¥–∏–∏", "–£–º–µ—Ä—à–∏–µ –æ—Ç —Å–æ—Å—É–¥–∏—Å—Ç–æ–≥–æ –ø–æ—Ä–∞–∂–µ–Ω–∏—è –º–æ–∑–≥–∞", "–£–º–µ—Ä—à–∏–µ –æ—Ç —É–±–∏–π—Å—Ç–≤",

                // üí° –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ
                "–ß–∏—Å–ª–æ –±—Ä–∞–∫–æ–≤", "–ß–∏—Å–ª–æ —Ä–∞–∑–≤–æ–¥–æ–≤", "–ö–æ—ç—Ñ—Ñ–∏—Ü–µ–Ω—Ç –±—Ä–∞—á–Ω–æ—Å—Ç–∏ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫",
                "–ö–æ—ç—Ñ—Ñ–∏—Ü–µ–Ω—Ç —Ä–∞–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫",

                // üéì –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
        
            ];


            // –û–±–Ω–æ–≤–ª—è–µ–º –±–æ–∫–æ–≤—É—é –ø–∞–Ω–µ–ª—å
            document.getElementById('district-info').innerHTML = `
                <h3>${districtName}</h3>
                <table>
                    <tr><th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th><th>–ó–Ω–∞—á–µ–Ω–∏–µ</th><th>–ò–∑–º–µ–Ω–µ–Ω–∏–µ</th></tr>
                    ${parameters.map(param => renderRow(param, properties)).join('')}
                </table>
            `;

            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–∞–π–æ–Ω–∞
            const districtData = fullDataset.filter(item => item.orig_district_name === districtName);
            updateChart(districtData);

            // –†–∞—Å–∫—Ä—ã—Ç–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
            const chartContainer = document.getElementById('chartContainer');
            chartContainer.classList.remove('minimized');
            chartContainer.classList.add('expanded');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
        function renderRow(name, properties) {
            const origKey = `orig_${name}`;
            const changeKey = `${name}_change`;

            const origValue = properties[origKey] !== undefined ? properties[origKey] : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            const changeValue = properties[changeKey] !== undefined ? properties[changeKey] : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';

            return `
                <tr>
                    <td>${name}</td>
                    <td>${origValue}</td>
                    <td>${changeValue}</td>
                </tr>
            `;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É QoL –∏ QoL_change
        function setupParameterSwitching() {
            document.getElementById('showCurrentQ').addEventListener('click', () => {
                showCurrent = true;
                updateLayer();
            });

            document.getElementById('showPreviousQ').addEventListener('click', () => {
                showCurrent = false;
                updateLayer();
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–æ—è —Å —É—á—ë—Ç–æ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
        function updateLayer() {
            const property = showCurrent ? 'QoL' : 'QoL_change';
            map.setPaintProperty('districts-layer', 'fill-color', [
                'step',
                ['get', property],
                '#6c757d', // –¶–≤–µ—Ç –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã—Ö
                0.1, '#d7191c',
                0.2, '#fdae61',
                0.3, '#a6d96a',
                0.5, '#1a9641'
            ]);
        }


        // –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
        function toggleFullScreen() {
            const fullscreenButton = document.querySelector('#fullscreen-toggle i'); // –ò–∫–æ–Ω–∫–∞ –∫–Ω–æ–ø–∫–∏
            const fullscreenButtonContainer = document.querySelector('#fullscreen-toggle'); // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–Ω–æ–ø–∫–∏

            // –ö—Ä–æ—Å—Å-–±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
            const element = document.documentElement;
            const requestFullscreen = element.requestFullscreen || element.webkitRequestFullscreen || element.mozRequestFullScreen || element.msRequestFullscreen;
            const exitFullscreen = document.exitFullscreen || document.webkitExitFullscreen || document.mozCancelFullScreen || document.msExitFullscreen;

            if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.mozFullScreenElement && !document.msFullscreenElement) {
                // –í—Ö–æ–¥–∏–º –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
                if (requestFullscreen) {
                    requestFullscreen.call(element)
                        .then(() => {
                            updateFullscreenButton(true); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É
                            console.log('–í–æ—à–ª–∏ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º');
                        })
                        .catch((err) => {
                            console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º: ${err.message}`);
                        });
                }
            } else {
                // –í—ã—Ö–æ–¥–∏–º –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
                if (exitFullscreen) {
                    exitFullscreen.call(document)
                        .then(() => {
                            updateFullscreenButton(false); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É
                            console.log('–í—ã—à–ª–∏ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞');
                        })
                        .catch((err) => {
                            console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞: ${err.message}`);
                        });
                }
            }

            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∫–æ–Ω–∫–∏ –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∫–Ω–æ–ø–∫–∏
            function updateFullscreenButton(isFullscreen) {
                if (isFullscreen) {
                    fullscreenButton.classList.remove('fa-expand');
                    fullscreenButton.classList.add('fa-compress');
                    fullscreenButtonContainer.setAttribute('title', '–°–≤–µ—Ä–Ω—É—Ç—å —ç–∫—Ä–∞–Ω');
                } else {
                    fullscreenButton.classList.remove('fa-compress');
                    fullscreenButton.classList.add('fa-expand');
                    fullscreenButtonContainer.setAttribute('title', '–í–æ –≤–µ—Å—å —ç–∫—Ä–∞–Ω');
                }
            }
        }


        // –û–±–Ω–æ–≤–ª—è–µ–º –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
        function updateSidebar(districtData) {
            const sidebarContent = document.getElementById('district-info');

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
            if (!districtData || districtData.length === 0) {
                console.warn('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–∞–π–æ–Ω–∞.');
                sidebarContent.innerHTML = `<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–∞–π–æ–Ω–∞.</p>`;
                return;
            }

            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–µ—Ä–∏–æ–¥
            const latestQuarter = districtData.reduce((latest, current) => {
                const latestDate = new Date(latest.orig_indicator_date || '1900-01-01');
                const currentDate = new Date(current.orig_indicator_date || '1900-01-01');
                return currentDate > latestDate ? current : latest;
            });

            console.log("–î–∞–Ω–Ω—ã–µ latestQuarter:", latestQuarter);
            console.log("–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª—é—á–∏:", Object.keys(latestQuarter)); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª—é—á–∏

            const parameters = [
                // üìä –î–µ–º–æ–≥—Ä–∞—Ñ–∏—è
                { label: "–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏—è", key: "orig_–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏—è" },
                { label: "–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å —Ä–æ–¥–∏–≤—à–∏—Ö—Å—è", key: "orig_–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å —Ä–æ–¥–∏–≤—à–∏—Ö—Å—è" },
                { label: "–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å —É–º–µ—Ä—à–∏—Ö", key: "orig_–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å —É–º–µ—Ä—à–∏—Ö" },
                { label: "–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç", key: "orig_–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç" },
                { label: "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–æ–∂–¥–∞–µ–º–æ—Å—Ç–∏ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫", key: "orig_–ö–æ—ç—Ñ—Ñ–∏—Ü–µ–Ω—Ç —Ä–æ–∂–¥–∞–µ–º–æ—Å—Ç–∏ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫" },
                { label: "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–º–µ—Ä—Ç–Ω–æ—Å—Ç–∏ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫", key: "orig_–ö–æ—ç—Ñ—Ñ–∏—Ü–µ–Ω—Ç —Å–º–µ—Ä—Ç–Ω–æ—Å—Ç–∏ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫" },
                { label: "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏—Ä–æ—Å—Ç–∞ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫", key: "orig_–ö–æ—ç—Ñ—Ñ–∏—Ü–µ–Ω—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏—Ä–æ—Å—Ç–∞ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫" },
                { label: "–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞—Å–µ–ª–µ–Ω–∏—è - –≤—ã–±—ã–ª–æ", key: "orig_–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞—Å–µ–ª–µ–Ω–∏—è - –≤—ã–±—ã–ª–æ" },
                { label: "–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞—Å–µ–ª–µ–Ω–∏—è - –ø—Ä–∏–±—ã–ª–æ", key: "orig_–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞—Å–µ–ª–µ–Ω–∏—è - –ø—Ä–∏–±—ã–ª–æ" },
                { label: "–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞—Å–µ–ª–µ–Ω–∏—è - —Å–∞–ª—å–¥–æ", key: "orig_–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞—Å–µ–ª–µ–Ω–∏—è - —Å–∞–ª—å–¥–æ" },

                // üèó –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∂–∏–ª—å—ë
                { label: "–í–≤–æ–¥ –∂–∏–ª—å—è", key: "orig_–í–≤–æ–¥ –∂–∏–ª—å—è" },
                { label: "–ú–Ω–æ–≥–æ–∫–≤–∞—Ä—Ç–∏—Ä–Ω—ã–µ –∂–∏–ª—ã–µ –¥–æ–º–∞", key: "orig_–ú–Ω–æ–≥–æ–∫–≤–∞—Ä—Ç–∏—Ä–Ω—ã–µ –∂–∏–ª—ã–µ –¥–æ–º–∞" },
                { label: "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∂–∏–ª—ã–µ –¥–æ–º–∞", key: "orig_–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∂–∏–ª—ã–µ –¥–æ–º–∞" },
                { label: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∏—Ä - –º–Ω–æ–≥–æ–∫–≤–∞—Ä—Ç–∏—Ä–Ω—ã–µ –¥–æ–º–∞", key: "orig_–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∏—Ä - –º–Ω–æ–≥–æ–∫–≤–∞—Ä—Ç–∏—Ä–Ω—ã–µ –¥–æ–º–∞" },

                // üí∞ –≠–∫–æ–Ω–æ–º–∏–∫–∞
                { label: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö", key: "orig_–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö" },
                { label: "–°—Ä–µ–¥–Ω–µ–º–µ—Å—è—á–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞", key: "orig_–°—Ä–µ–¥–Ω–µ–º–µ—Å—è—á–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ-–ø—Ä–∞–≤–æ–≤—ã–º —Ñ–æ—Ä–º–∞–º" },
                { label: "–ò–Ω–¥–µ–∫—Å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –æ–±—ä—ë–º–∞, –ø–æ –≤—Å–µ–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç–∏", key: "orig_–ò–Ω–¥–µ–∫—Å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –æ–±—ä—ë–º–∞, –ø–æ –≤—Å–µ–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç–∏" },
                { label: "–û–±—ä—ë–º –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏ –ø–æ –≤—Å–µ–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç–∏", key: "orig_–û–±—ä—ë–º –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏ –ø–æ –≤—Å–µ–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç–∏" },
                { label: "–í—Å–µ–≥–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö –∫—Ä—É–ø–Ω—ã—Ö –∏ —Å—Ä–µ–¥–Ω–∏—Ö –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π", key: "orig_–í—Å–µ–≥–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö –∫—Ä—É–ø–Ω—ã—Ö –∏ —Å—Ä–µ–¥–Ω–∏—Ö –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π" },
                { label: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫—Ä—É–ø–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π", key: "orig_–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫—Ä—É–ø–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π" },
                { label: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞–ª—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π", key: "orig_–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞–ª—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π" },
                { label: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ä–µ–¥–Ω–∏—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π", key: "orig_–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ä–µ–¥–Ω–∏—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π" },
                { label: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—É–±—ä–µ–∫—Ç–æ–≤ –≤—Å–µ–≥–æ –ø–æ —Ä–∞–π–æ–Ω—É", key: "orig_–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—É–±—ä–µ–∫—Ç–æ–≤ –≤—Å–µ–≥–æ –ø–æ —Ä–∞–π–æ–Ω—É" },
                { label: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö —Å—É–±—ä–µ–∫—Ç–æ–≤ –≤—Å–µ–≥–æ –ø–æ —Ä–∞–π–æ–Ω—É", key: "orig_–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö —Å—É–±—ä–µ–∫—Ç–æ–≤ –≤—Å–µ–≥–æ –ø–æ —Ä–∞–π–æ–Ω—É" },
                { label: "–î–µ–π—Å—Ç–≤—É—é—â–∏–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—É–±—ä–µ–∫—Ç—ã –º–∞–ª–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–∞", key: "orig_–î–µ–π—Å—Ç–≤—É—é—â–∏–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—É–±—ä–µ–∫—Ç—ã –º–∞–ª–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–∞" },
                { label: "–í—Å–µ–≥–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—É–±—ä–µ–∫—Ç–æ–≤ –º–∞–ª–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–∞", key: "orig_–í—Å–µ–≥–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—É–±—ä–µ–∫—Ç–æ–≤ –º–∞–ª–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–∞ (—é—Ä–∏–¥. –∏ —Ñ–∏–∑. –ª–∏—Ü–∞)" },
                { label: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π", key: "orig_–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ-–ø—Ä–∞–≤–æ–≤—ã–º —Ñ–æ—Ä–º–∞–º" },
                { label: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö —á–∞—Å—Ç–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π", key: "orig_–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö —á–∞—Å—Ç–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ-–ø—Ä–∞–≤–æ–≤—ã–º —Ñ–æ—Ä–º–∞–º" },
                { label: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π", key: "orig_–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ-–ø—Ä–∞–≤–æ–≤—ã–º —Ñ–æ—Ä–º–∞–º" },

                // üö® –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å–º–µ—Ä—Ç–Ω–æ—Å—Ç—å
                { label: "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –º–ª–∞–¥–µ–Ω—á–µ—Å–∫–æ–π —Å–º–µ—Ä—Ç–Ω–æ—Å—Ç–∏ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫", key: "orig_–ö–æ—ç—Ñ—Ñ–∏—Ü–µ–Ω—Ç –º–ª–∞–¥–µ–Ω—á–µ—Å–∫–æ–π —Å–º–µ—Ä—Ç–Ω–æ—Å—Ç–∏ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç –Ω–µ—Å—á–∞—Å—Ç–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤, –æ—Ç—Ä–∞–≤–ª–µ–Ω–∏–π –∏ —Ç—Ä–∞–≤–º", key: "orig_–£–º–µ—Ä—à–∏–µ  –æ—Ç –Ω–µ—Å—á–∞—Å—Ç–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤, –æ—Ç—Ä–∞–≤–ª–µ–Ω–∏–π –∏ —Ç—Ä–∞–≤–º" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç —Å–∞–º–æ—É–±–∏–π—Å—Ç–≤", key: "orig_–£–º–µ—Ä—à–∏–µ  –æ—Ç —Å–∞–º–æ—É–±–∏–π—Å—Ç–≤" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç –±–æ–ª–µ–∑–Ω–µ–π –æ—Ä–≥–∞–Ω–æ–≤ –¥—ã—Ö–∞–Ω–∏—è", key: "orig_–£–º–µ—Ä—à–∏–µ –æ—Ç –±–æ–ª–µ–∑–Ω–µ–π –æ—Ä–≥–∞–Ω–æ–≤ –¥—ã—Ö–∞–Ω–∏—è" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç –±–æ–ª–µ–∑–Ω–µ–π –æ—Ä–≥–∞–Ω–æ–≤ –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏—è", key: "orig_–£–º–µ—Ä—à–∏–µ –æ—Ç –±–æ–ª–µ–∑–Ω–µ–π –æ—Ä–≥–∞–Ω–æ–≤ –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏—è" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç –±–æ–ª–µ–∑–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏—è", key: "orig_–£–º–µ—Ä—à–∏–µ –æ—Ç –±–æ–ª–µ–∑–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏—è" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç –≥–∏–ø–µ—Ä—Ç–æ–Ω–∏—á–µ—Å–∫–æ–π –±–æ–ª–µ–∑–Ω–∏", key: "orig_–£–º–µ—Ä—à–∏–µ –æ—Ç –≥–∏–ø–µ—Ä—Ç–æ–Ω–∏—á–µ—Å–∫–æ–π –±–æ–ª–µ–∑–Ω–∏" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç –≥—Ä–∏–ø–ø–∞, –û–†–ó –∏ –ø–Ω–µ–≤–º–æ–Ω–∏–∏", key: "orig_–£–º–µ—Ä—à–∏–µ –æ—Ç –≥—Ä–∏–ø–ø–∞, –û–†–ó –∏ –ø–Ω–µ–≤–º–æ–Ω–∏–∏" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç –¥–æ—Ä–æ–∂–Ω–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏–π", key: "orig_–£–º–µ—Ä—à–∏–µ –æ—Ç –¥–æ—Ä–æ–∂–Ω–æ-—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö –ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏–π" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç –∑–ª–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –Ω–æ–≤–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π", key: "orig_–£–º–µ—Ä—à–∏–µ –æ—Ç –∑–ª–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –Ω–æ–≤–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç –∏–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω—ã—Ö –∏ –ø–∞—Ä–∞–∑–∏—Ç–∞—Ä–Ω—ã—Ö –±–æ–ª–µ–∑–Ω–µ–π", key: "orig_–£–º–µ—Ä—à–∏–µ –æ—Ç –∏–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω—ã—Ö –∏ –ø–∞—Ä–∞–∑–∏—Ç–∞—Ä–Ω—ã—Ö –±–æ–ª–µ–∑–Ω–µ–π" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç –∏—à–µ–º–∏—á–µ—Å–∫–æ–π –±–æ–ª–µ–∑–Ω–∏ —Å–µ—Ä–¥—Ü–∞", key: "orig_–£–º–µ—Ä—à–∏–µ –æ—Ç –∏—à–µ–º–∏—á–µ—Å–∫–æ–π –±–æ–ª–µ–∑–Ω–∏ —Å–µ—Ä–¥—Ü–∞" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç –Ω–æ–≤–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π", key: "orig_–£–º–µ—Ä—à–∏–µ –æ—Ç –Ω–æ–≤–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç –æ—Å—Ç—Ä–æ–≥–æ –∏–Ω—Ñ–∞—Ä–∫—Ç–∞ –º–∏–æ–∫–∞—Ä–¥–∞", key: "orig_–£–º–µ—Ä—à–∏–µ –æ—Ç –æ—Å—Ç—Ä–æ–≥–æ –∏–Ω—Ñ–∞—Ä–∫—Ç–∞ –º–∏–æ–∫–∞—Ä–¥–∞" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç —Å—Ç–µ–Ω–æ–∫–∞—Ä–¥–∏–∏", key: "orig_–£–º–µ—Ä—à–∏–µ –æ—Ç —Å—Ç–µ–Ω–æ–∫–∞—Ä–¥–∏–∏" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç —Å–æ—Å—É–¥–∏—Å—Ç–æ–≥–æ –ø–æ—Ä–∞–∂–µ–Ω–∏—è –º–æ–∑–≥–∞", key: "orig_–£–º–µ—Ä—à–∏–µ –æ—Ç —Å—É–¥–∏—Å—Ç–æ–≥–æ –ø–æ—Ä–∞–∂–µ–Ω–∏—è –º–æ–∑–≥–∞" },
                { label: "–£–º–µ—Ä—à–∏–µ –æ—Ç —É–±–∏–π—Å—Ç–≤", key: "orig_–£–º–µ—Ä—à–∏–µ –æ—Ç —É–±–∏–π—Å—Ç–≤" },

                // üí° –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ
                { label: "–ß–∏—Å–ª–æ –±—Ä–∞–∫–æ–≤", key: "orig_–ß–∏—Å–ª–æ –±—Ä–∞–∫–æ–≤" },
                { label: "–ß–∏—Å–ª–æ —Ä–∞–∑–≤–æ–¥–æ–≤", key: "orig_–ß–∏—Å–ª–æ —Ä–∞–∑–≤–æ–¥–æ–≤" },
                { label: "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –±—Ä–∞—á–Ω–æ—Å—Ç–∏ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫", key: "orig_–ö–æ—ç—Ñ—Ñ–∏—Ü–µ–Ω—Ç –±—Ä–∞—á–Ω–æ—Å—Ç–∏ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫" },
                { label: "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–∞–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫", key: "orig_–ö–æ—ç—Ñ—Ñ–∏—Ü–µ–Ω—Ç —Ä–∞–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞ 1000 —á–µ–ª–æ–≤–µ–∫" },

                // üéì –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
            ];

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
            const tableRows = parameters.map(param => {
                // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å —É—á—ë—Ç–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª—é—á–µ–π
                const value = latestQuarter.hasOwnProperty(param.key) ? latestQuarter[param.key] : '-';

                const displayValue = (value !== undefined && value !== null && value !== "")
                    ? value.toLocaleString() 
                    : '-';

                return `
                    <tr>
                        <td style="padding: 8px;">${param.label}</td>
                        <td style="padding: 8px;">${displayValue}</td>
                    </tr>
                `;
            }).join('');

            // –û–±–Ω–æ–≤–ª—è–µ–º HTML –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
            sidebarContent.innerHTML = `
                <h3>${latestQuarter.orig_district_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–∞–π–æ–Ω'}</h3>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <tr>
                        <th style="text-align: left; border-bottom: 1px solid #ddd; padding: 8px;">–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
                        <th style="text-align: left; border-bottom: 1px solid #ddd; padding: 8px;">–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                    </tr>
                    ${tableRows}
                </table>
            `;
        }



        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
        function updateChart(districtData) {
            const ctx = document.getElementById('qChart').getContext('2d');

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö
            if (!districtData || districtData.length === 0) {
                console.warn('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞.');
                return;
            }

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ –¥–∞—Ç–µ
            const chartData = districtData
                .filter(d => d.orig_indicator_date && d.QoL !== undefined)
                .sort((a, b) => new Date(a.orig_indicator_date) - new Date(b.orig_indicator_date))
                .map(d => ({
                    date: d.orig_indicator_date,
                    value: d.QoL,
                    delta: d.QoL_change || 0
                }));

            const labels = chartData.map(item => item.date);
            const values = chartData.map(item => item.value);
            const changes = chartData.map(item => item.delta);

            // –¶–≤–µ—Ç–∞ —Ç–æ—á–µ–∫ –¥–ª—è QoL
            const pointColorsQoL = values.map(value => {
                if (value < 0.1) return '#d7191c'; // –û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π QoL (–∫—Ä–∞—Å–Ω—ã–π)
                if (value < 0.3) return '#fdae61'; // –°—Ä–µ–¥–Ω–∏–π QoL (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)
                if (value < 0.5) return '#a6d96a'; // –í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ QoL (–∑–µ–ª—ë–Ω—ã–π)
                return '#1a9641';                // –í—ã—Å–æ–∫–∏–π QoL (—Ç—ë–º–Ω–æ-–∑–µ–ª—ë–Ω—ã–π)
            });

            // –¶–≤–µ—Ç–∞ —Ç–æ—á–µ–∫ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è QoL
            const pointColorsChange = changes.map(change => {
                if (change > 0) return '#1a9641'; // –†–æ—Å—Ç (–∑–µ–ª—ë–Ω—ã–π)
                if (change < 0) return '#d7191c'; // –ü–∞–¥–µ–Ω–∏–µ (–∫—Ä–∞—Å–Ω—ã–π)
                return '#6c757d';                // –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Å–µ—Ä—ã–π)
            });

            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if (chartInstance) {
                chartInstance.destroy();
            }

            // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [
                        {
                            label: '–ò–Ω–¥–µ–∫—Å QoL',
                            data: values,
                            borderColor: '#1a9641', // –ó–µ–ª—ë–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –ª–∏–Ω–∏–∏ QoL
                            backgroundColor: 'rgba(26, 150, 65, 0.1)',
                            pointBackgroundColor: pointColorsQoL,
                            pointRadius: 5,
                            tension: 0.3
                        },
                        {
                            label: '–ò–∑–º–µ–Ω–µ–Ω–∏–µ QoL (%)',
                            data: changes,
                            borderColor: '#6c757d', // –°–µ—Ä—ã–π —Ü–≤–µ—Ç –¥–ª—è –ª–∏–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
                            backgroundColor: 'rgba(108, 117, 125, 0.1)',
                            pointBackgroundColor: pointColorsChange,
                            pointRadius: 4,
                            borderDash: [5, 5],
                            tension: 0.3,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true },
                        title: {
                            display: true,
                            text: '–î–∏–Ω–∞–º–∏–∫–∞ –∏–Ω–¥–µ–∫—Å–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∂–∏–∑–Ω–∏'
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const value = context.raw !== null ? context.raw.toFixed(2) : "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö";
                                    return context.dataset.label.includes('QoL')
                                        ? `${context.dataset.label}: ${value}`
                                        : `${context.dataset.label}: ${value}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: '–î–∞—Ç–∞' }
                        },
                        y: {
                            title: { display: true, text: '–ò–Ω–¥–µ–∫—Å QoL' },
                            beginAtZero: true
                        },
                        y1: {
                            position: 'right',
                            title: { display: true, text: '–ò–∑–º–µ–Ω–µ–Ω–∏–µ QoL (%)' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }


        function drawMultiDistrictChart() {
            const canvas = document.getElementById("multiDistrictChart");
            if (!canvas) {
                console.warn("–≠–ª–µ–º–µ–Ω—Ç multiDistrictChart –Ω–µ –Ω–∞–π–¥–µ–Ω.");
                return;
            }
            const ctx = canvas.getContext("2d");

            if (!fullDataset || fullDataset.length === 0) {
                console.warn("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞.");
                return;
            }

            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ä–∞–π–æ–Ω–∞–º
            const groupedData = {};
            fullDataset.forEach(entry => {
                if (!entry.orig_district_name || entry.QoL === undefined) return; // –ü—Ä–æ–ø—É—Å–∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                if (!groupedData[entry.orig_district_name]) {
                    groupedData[entry.orig_district_name] = [];
                }
                groupedData[entry.orig_district_name].push({
                    date: entry.orig_indicator_date,
                    QoL: entry.QoL
                });
            });

            const sortedDistricts = Object.keys(groupedData).sort();
            if (sortedDistricts.length === 0) {
                console.warn("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ä–∞–π–æ–Ω–∞–º.");
                return;
            }

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤—Å–µ—Ö –¥–∞—Ç
            const allDates = [...new Set(fullDataset.map(d => d.orig_indicator_date))].sort();

            // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ü–≤–µ—Ç–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            function generateColor(index, total) {
                const hue = (index / total) * 360;
                return `hsl(${hue}, 70%, 50%)`;
            }

            const datasets = sortedDistricts.map((district, index) => {
                const color = generateColor(index, sortedDistricts.length);
                const dataMap = Object.fromEntries(groupedData[district].map(d => [d.date, d.QoL]));
                const values = allDates.map(date => dataMap[date] !== undefined ? dataMap[date] : null);

                return {
                    label: district,
                    data: values,
                    borderColor: color,
                    backgroundColor: "transparent",
                    pointRadius: 2,
                    tension: 0.3
                };
            });

            if (window.multiDistrictChartInstance) {
                window.multiDistrictChartInstance.destroy();
            }

            window.multiDistrictChartInstance = new Chart(ctx, {
                type: "line",
                data: {
                    labels: allDates,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true },
                        title: { display: true, text: "–ò–Ω–¥–µ–∫—Å –∫–∞—á–µ—Å—Ç–≤–∞ –∂–∏–∑–Ω–∏ –ø–æ —Ä–∞–π–æ–Ω–∞–º" },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `${context.dataset.label}: ${context.raw !== null ? context.raw.toFixed(2) : "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: "–î–∞—Ç–∞" } },
                        y: { title: { display: true, text: "–ò–Ω–¥–µ–∫—Å QoL" }, beginAtZero: true }
                    }
                }
            });
        }


        document.addEventListener("DOMContentLoaded", () => {
            // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            const fullscreenToggle = document.getElementById("fullscreen-toggle");
            const showCurrentQ = document.getElementById("showCurrentQ");
            const showPreviousQ = document.getElementById("showPreviousQ");
            const opacitySlider = document.getElementById("opacity-slider");
            const sidebar = document.getElementById("sidebar");
            const toggleSidebarButton = document.getElementById("toggleSidebar");
            const chartContainer = document.getElementById("chartContainer");
            const multiChartContainer = document.getElementById("multiDistrictChartContainer");
            const expandChartButton = document.getElementById("expandChart");
            const multiChartFullscreenButton = document.getElementById("toggleMultiDistrictFullscreen");
            const showMultiDistrictChart = document.getElementById("showMultiDistrictChart");
            const showSingleDistrictChart = document.getElementById("showSingleDistrictChart");
            const methodologyButton = document.getElementById("showMethodology");
            const modal = document.getElementById("modal");
            const closeModalButton = document.querySelector(".close-modal");

            let isFullscreen = false;
            let showQMode = "current"; // –†–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è QoL

            /** üåê –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º */
            fullscreenToggle.addEventListener("click", () => {
                const element = document.documentElement;

                if (!isFullscreen) {
                    if (element.requestFullscreen) element.requestFullscreen();
                    else if (element.webkitRequestFullscreen) element.webkitRequestFullscreen();
                    else if (element.msRequestFullscreen) element.msRequestFullscreen();

                    fullscreenToggle.innerHTML = `<i class="fas fa-compress"></i>`;
                    fullscreenToggle.title = "–°–≤–µ—Ä–Ω—É—Ç—å";
                } else {
                    if (document.exitFullscreen) document.exitFullscreen();
                    else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
                    else if (document.msExitFullscreen) document.msExitFullscreen();

                    fullscreenToggle.innerHTML = `<i class="fas fa-expand"></i>`;
                    fullscreenToggle.title = "–í–æ –≤–µ—Å—å —ç–∫—Ä–∞–Ω";
                }
                isFullscreen = !isFullscreen;
            });

            /** üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ç–µ–∫—É—â–∏–º QoL –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º QoL */
            function updateLayerColor() {
                if (!map.isStyleLoaded()) {
                    console.warn("–ö–∞—Ä—Ç–∞ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
                    return;
                }

                const property = showQMode === "current" ? "QoL" : "QoL_change";
                map.setPaintProperty("districts-layer", "fill-color", [
                    "step",
                    ["get", property],
                    "#6c757d", // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö
                    0.1, "#d7191c",
                    0.3, "#fdae61",
                    0.5, "#a6d96a",
                    0.7, "#1a9641"
                ]);
            }

            showCurrentQ.addEventListener("click", () => {
                showQMode = "current";
                updateLayerColor();
            });

            showPreviousQ.addEventListener("click", () => {
                showQMode = "previous";
                updateLayerColor();
            });

            /** üéöÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ –∫–∞—Ä—Ç—ã */
            opacitySlider.addEventListener("input", (e) => {
                const opacity = parseFloat(e.target.value);
                if (map.isStyleLoaded()) {
                    map.setPaintProperty("districts-layer", "fill-opacity", opacity);
                }
            });

            /** üìå –°–∫—Ä—ã—Ç–∏–µ/–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
            toggleSidebarButton.addEventListener("click", () => {
                sidebar.classList.toggle("collapsed");
                toggleSidebarButton.classList.toggle("collapsed");

                const isCollapsed = sidebar.classList.contains("collapsed");
                toggleSidebarButton.style.left = isCollapsed ? "20px" : "410px";

                const icon = toggleSidebarButton.querySelector("i");
                icon.classList.toggle("fa-chevron-left", !isCollapsed);
                icon.classList.toggle("fa-chevron-right", isCollapsed);
            });

            /** üìä –°–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ */
            function toggleChart(chart, button) {
                chart.classList.toggle("minimized");
                chart.classList.toggle("expanded");

                button.innerHTML = chart.classList.contains("expanded")
                    ? `<i class="fas fa-compress"></i>`  // "–°–≤–µ—Ä–Ω—É—Ç—å"
                    : `<i class="fas fa-expand"></i>`;   // "–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"

                // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤
                if (chart.contains(document.getElementById("qChart")) && window.chartInstance) {
                    window.chartInstance.resize();
                }
                if (chart.contains(document.getElementById("multiDistrictChart")) && window.multiDistrictChartInstance) {
                    window.multiDistrictChartInstance.resize();
                }
            }

            expandChartButton.addEventListener("click", () => {
                toggleChart(chartContainer, expandChartButton);
            });

            multiChartFullscreenButton.addEventListener("click", () => {
                if (!document.fullscreenElement) {
                    multiChartContainer.requestFullscreen().catch(err => {
                        console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º: ${err.message}`);
                    });
                } else {
                    document.exitFullscreen();
                }
            });

            /** üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –æ–¥–∏–Ω–æ—á–Ω—ã–º –∏ –º—É–ª—å—Ç–∏-–≥—Ä–∞—Ñ–∏–∫–æ–º */
            showSingleDistrictChart.addEventListener("click", () => {
                chartContainer.classList.remove("minimized");
                chartContainer.classList.add("expanded");
                multiChartContainer.classList.add("minimized");
            });

            showMultiDistrictChart.addEventListener("click", () => {
                multiChartContainer.classList.remove("minimized");
                multiChartContainer.classList.add("expanded");
                chartContainer.classList.add("minimized");
            });

            /** üìñ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ */
            methodologyButton.addEventListener("click", () => {
                modal.style.display = "block";
            });

            closeModalButton.addEventListener("click", () => {
                modal.style.display = "none";
            });

            window.addEventListener("click", (event) => {
                if (event.target === modal) {
                    modal.style.display = "none";
                }
            });
        });



        document.getElementById("showMultiDistrictChart").addEventListener("click", () => {
            const container = document.getElementById("multiDistrictChartContainer");
            container.classList.toggle("minimized");
            container.classList.toggle("expanded");

            drawMultiDistrictChart();
        });

        document.getElementById("toggleMultiDistrictFullscreen").addEventListener("click", () => {
            const chartContainer = document.getElementById("multiDistrictChartContainer");
            if (!document.fullscreenElement) {
                chartContainer.requestFullscreen().catch(err => {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        });

      

    </script>
</body>

</html>